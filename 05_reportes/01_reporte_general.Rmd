---
title: "Reporte Monitor PPD"
subtitle: "junio - agosto 2022"
author: "Alejandro Pocoroba"
date: "Actualizado el `r format(Sys.time(), '%d-%m-%Y')`"
output: 
  rmarkdown::pdf_document:
    toc: true 
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# Paquetes
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)

# Librerías 
require(pacman)
p_load(
  readxl, tidyverse, dplyr, scales, zoo, mxmaps, sf)

# Limpiar espacio de trabajo 
rm(list=ls())
```

```{r dataframes}
# Funciones con direcciones de las carpetas
paste_out <- function(x){paste0("../03_datos_limpios/", x)}
paste_fig <- function(x){paste0("../04_figuras/"      , x)}

load(paste_out("df_monitor_amplio.Rdata"))

```

```{r Configuración de figuras}
v_caption <- "Fuente: Elaboracón propia con datos del Monitor-PPD 2022"

```
# Monitor de noticias del Programa de Política de Drogas 

El monitor del noticias del Programa de Política de Drogas (Monitor-PPD) es un esfuerzo por documentar los hechos descritos en distintas fuentes abiertas sobre las actividades delictivas, en especifico, la violencia criminal en los 32 estados de México. Las fuentes abiertas consultadas son medios regionales e internacionales, blogs, redes sociales y comunidados de las autoridades. 

El total de obseraciones del 01-06 al `r format(Sys.time(), '%d-%m-%Y')` es de `r comma(length(df_monitor_amplio$id))`

Las fuentes que se han consultado son `r unique(df_monitor_amplio$nombre_de_la_fuente, na.rm =T)`

# Muertes
## Número de personas asesinadas

El total de homicidios identificados entre junio y agosto fue de `r comma(sum(df_monitor_amplio$numero_de_homicidios_total, na.rm =T))`, de los cuales `r comma(sum(df_monitor_amplio$numero_de_homicidios_hombre, na.rm =T))` son hombres y `r comma(sum(df_monitor_amplio$numero_de_homicidios_mujer, na.rm =T))` son mujeres. 

Las personas asesinadas pertenecian/trabajaban como  `r unique(df_monitor_amplio$pertenece_a, na.rm =T)`

```{r homicidios}

# # Homicidios por entidad 
# df_data2 <- df_monitor_amplio %>% 
#   select(-c(id:sobre_la_nota), -enlace) %>% 
#   filter(numero_de_homicidios_total>0) %>% 
#   group_by(estado) %>% 
#   summarise(homicidio_total = sum(numero_de_homicidios_total, na.rm = T)) %>% 
#   drop_na()
# 
# 
# ggplot(df_data2, 
#   aes(x = reorder(estado, homicidio_total), y = homicidio_total)) + 
#   # Geoms
#   geom_col() +
#   geom_text(aes(label = homicidio_total), vjust = +0.4, hjust = -0.2) +
#   coord_flip() +
#   # Etiqueta
#   labs(
#     title = "Homicidios en México",
#     subtitle = "Por estado de junio a agosto de 2022", 
#     x = "Estado",
#     y = "Número de homicidios", 
#     caption = v_caption) + 
#   # Escalas
#   # Tema 
#   theme_bw() + 
#   theme(legend.position = "none")

```

## Cuerpos en espacios públicos

El número total de cuerpos y/o restos humanos localizados en espacios públicos fue de 1,479.

```{r graph1, echo = F, out.width="100%", fig.align = 'center', cache=FALSE}
# knitr::include_graphics(paste_fig("estados_homi.png"))
```


# Personas heridas
El número de personas heridas es de `r comma(sum(df_monitor_amplio$numero_de_heridos_as_total, na.rm =T))`. De este número `r comma(sum(df_monitor_amplio$numero_de_heridos_hombres, na.rm =T))` son hombres y mujeres son `r comma(sum(df_monitor_amplio$numero_de_heridas_mujeres, na.rm =T))`

Las personas heridas pertenecian/trabajaban como  `r unique(df_monitor_amplio$herido_a_pertenece_a, na.rm =T)`


# Detenciones
El número de personas detenidas es de `r comma(sum(df_monitor_amplio$numero_de_detenidos_as_total, na.rm =T))`. De este número `r comma(sum(df_monitor_amplio$numero_de_detenidos_hombres, na.rm =T))` son hombres y mujeres son `r comma(sum(df_monitor_amplio$numero_de_detenidas_mujeres, na.rm =T))`

Las personas detenidas pertenecian/trabajaban como  `r unique(df_monitor_amplio$detenido_a_pertenece_a, na.rm =T)`

# Grupos criminales 
## Presencia de grupos criminales
La lista de grupos criminales que se han identificado son `r unique(df_monitor_amplio$nombre_del_grupo_criminal_gc, na.rm =T)`, 

Algunos de estos grupos se encuentran en alianza con `r unique(df_monitor_amplio$alianza_del_gc, na.rm =T)` 

En rivalidad con `r unique(df_monitor_amplio$rival_del_gc, na.rm =T)`

## Presencia no violenta
También se ha identificado la presencia no violenta de los grupos criminales en activiades tales como `r unique(df_monitor_amplio$presencia_no_violenta, na.rm =T)`

## Presencia internacional
Se ha identificado la presencia criminal de grupos criminales mexicanos en el extranjero en  `r unique(df_monitor_amplio$pais, na.rm =T)`

# Inseguridad, violencia y activiades delictivas

## Ataque armados
Los ataques que se han registrado son `r names(table(df_monitor_amplio$ataque_armado))`

## Tráfico 
En México se realiza tráfico ilegal de `r names(table(df_monitor_amplio$trafico))`

## Narcomensajes
El número de narcamensajes en espacios públicos fue de 131

## Otras actividades delictivas
Otras actividades delictivas que se han identificado son `r names(table(df_monitor_amplio$otras_actividades_ilicitas))`

## Número de personas privadas de la libertad
Son `r comma(sum(df_monitor_amplio$numero_de_personas_privadas_de_su_libertad, na.rm =T))` personas privadas de la libertad o que se encuentran como desaparecidas

# Fuerzas Armadas e instituciones de seguridad
## Fuerzas Armadas

Las autoridades militares que se han identificado en el Monitor PPD son `r unique(df_monitor_amplio$autoridad_militar, na.rm =T)`

En actividades como `r unique(df_monitor_amplio$tipo_de_actividad_militar, na.rm =T)`


## Instituciones de seguridad 

Las autoridades civiles que se han identificado en el Monitor PPD `r unique(df_monitor_amplio$autoridad_civil, na.rm =T)`

En actividades como `r unique(df_monitor_amplio$tipo_de_actividad_civil, na.rm =T)`


## Tabla homicidios
```{r}
df_corto1 <- df_monitor_amplio %>% 
  # variables de interés
  select(numero_de_homicidios_total, 
         numero_de_homicidios_hombre,
         numero_de_homicidios_mujer, 
         numero_de_heridos_total = numero_de_heridos_as_total,
         numero_de_heridos_hombres, 
         numero_de_heridas_mujeres,
         numero_de_detenidos_total = numero_de_detenidos_as_total,
         numero_de_detenidos_hombres, 
         numero_de_detenidas_mujeres) %>% 
  summarize_all(~sum(., na.rm = T))   %>% 
  rename_all(~stringr::str_replace(.,"^numero_de_","")) %>% 
  pivot_longer(
    cols = homicidios_total:detenidas_mujeres, 
    names_to = c("evento", "sexo"),
    names_sep = "_", 
    values_to = "total"
  ) %>% 
  mutate(
    # sexo = if_else(sexo == "as", "total", sexo)
    sexo = case_when(
      sexo == "as"    ~ "Total", 
      sexo == "total" ~ "Total", 
      str_detect(sexo, "hom") ~ "Hombres", 
      str_detect(sexo, "muj") ~ "Mujeres"), 
    evento = case_when(
      str_detect(evento, "det") ~ "Detenidos(as)" ,
      str_detect(evento, "her") ~ "Heridos(as)" ,
      T ~ "Homicidios"
          )
    ) %>% 
  group_by(evento, sexo) %>% 
  summarise(total = sum(total)) %>% 
  mutate(total = scales::comma(total)) %>% 
  pivot_wider(
    names_from = sexo, 
    values_from = total
  ) %>% 
  arrange(desc(evento)) %>% 
  rename(Evento = evento)


knitr::kable(df_corto1)
```
# Mapa desparecidos
```{r}
df_corto <- df_monitor_amplio %>% 
  # variables de interés
  select(estado, nombre_del_grupo_criminal_gc, alianza_del_gc, rival_del_gc,
         numero_de_homicidios_total, numero_de_homicidios_hombre,
         numero_de_homicidios_mujer, 
         numero_de_heridos_as_total, numero_de_heridos_hombres, 
         numero_de_heridas_mujeres,
         numero_de_detenidos_as_total, numero_de_detenidos_hombres, 
         numero_de_detenidas_mujeres,
         ataque_armado, 
         privacion_de_la_libertad, numero_de_personas_privadas_de_su_libertad,
         autoridad_militar, tipo_de_actividad_militar,
         autoridad_civil, tipo_de_actividad_civil) 

df_desparecidos <- df_corto %>% 
  # variables de interés
  select(estado, numero_de_personas_privadas_de_su_libertad) %>% 
  group_by(estado) %>% 
  summarize(total_desparecidos = sum(numero_de_personas_privadas_de_su_libertad, na.rm = T)) %>% 
  mutate(region = str_sub(estado, -2, -1)) %>% 
  left_join(mxstate.map, by = "region")

#  Figura 
cols <- RColorBrewer::brewer.pal(3,'Blues')[c(1,3)]

ggplot(
  # Datos
  df_desparecidos,
  # Coordenadas
  aes(long, lat, group = group, fill = total_desparecidos)) +
  coord_map() +
  geom_polygon(color = "black", size = .2, show.legend = T, alpha = 1) +
  labs(title = "Personsas desaparecidas y/ sin localizar en México",
       subtitle = "Entre junio, julio y agosto del 2022\n",
       fill = "Número", 
       caption = "Fuente: Monitor-PPD (2022)") +
  scale_fill_gradient(low=cols[1],high=cols[2]) +
  theme(axis.line = element_blank(), 
        axis.ticks = element_blank(), 
        axis.text = element_blank(), 
        axis.title = element_blank(),
        panel.background = element_rect(fill = "white", 
                                        colour = NA)        
        )
```

