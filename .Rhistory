group_by(fecha_de_los_hechos) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_homicidios_d2)
# 3) Total homicidios - municipal
df_homicidios_d3 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos, numero_de_homicidios_total) %>%
filter(numero_de_homicidios_total >= "1") %>%
group_by(municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_homicidios_d3)
##### Cuerpos localizados -----
# 1) Homicidios - cuerpos localizados: general
df_cuerpos_d1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos, numero_de_homicidios_total, pertenece_a, cuerpo_s_localizado_s) %>%
filter(cuerpo_s_localizado_s == "TRUE") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_cuerpos_d1)
# Total
sum(df_cuerpos_d1$total_homicidios, na.rm = T) # cuerpos localizados: 66
# 2) H - cuerpos localizados: fecha de los hechos
df_cuerpos_d2 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos, numero_de_homicidios_total, pertenece_a, cuerpo_s_localizado_s) %>%
filter(cuerpo_s_localizado_s == "TRUE") %>%
group_by(fecha_de_los_hechos) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_cuerpos_d2)
# 3) H - cuerpos localizados: municipios
df_cuerpos_d3 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos, numero_de_homicidios_total, pertenece_a, cuerpo_s_localizado_s) %>%
filter(cuerpo_s_localizado_s == "TRUE") %>%
group_by(municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_cuerpos_d3)
##### Agresión -----
# 1) Homicidios - agresión: en general
df_agre_d1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "agresión") %>%
filter(numero_de_homicidios_total >= "1") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
# Total
sum(df_agre_d1$total_homicidios) # homicidios por agresión: 59
# 2) H - agresión: fecha de los hechos
df_agre_d2 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "agresión") %>%
filter(numero_de_homicidios_total >= "1") %>%
group_by(fecha_de_los_hechos) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_agre_d2)
mean(df_agre_d2$total_homicidios)
# 3) H - agresión: municipios
df_agre_d3 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "agresión") %>%
filter(numero_de_homicidios_total >= "1") %>%
group_by(municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_agre_d3)
##### Enfrentamientos -----
# 1) Homicidios - enfrentamiento: en general
df_enfren_d1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "enfrentamiento") %>%
filter(numero_de_homicidios_total >= "1") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_enfren_d1)
# Total
sum(df_enfren_d1$total_homicidios) # homicidios en enfrentamiento: 6
# 2) Homicidios - enfrentamiento: fecha de los hechos
df_enfren_d2 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "enfrentamiento") %>%
filter(numero_de_homicidios_total >= "1") %>%
group_by(fecha_de_los_hechos) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_enfren_d2)
# 3) Homicidios - enfrentamiento: municipios
df_enfren_d3 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "enfrentamiento") %>%
filter(numero_de_homicidios_total >= "1") %>%
group_by(municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
view(df_enfren_d3)
##### Arma blanca -----
# 1) Homicidios - arma blanca: general
df_arblanca_d1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "ataque con arma blanca") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_homicidios = sum(numero_de_homicidios_total, na.rm = T))
# Total
sum(df_arblanca_d1$total_homicidios) # arma blanca: 0
#### Heridxs--------------------------------------------------------------
# 1) Total heridxs: general
df_heridxs_d1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos, numero_de_heridos_as_total) %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_heridxs = sum(numero_de_heridos_as_total, na.rm = T))
view(df_heridxs_d1)
# Total
sum(df_heridxs_d1$total_heridxs) # heridxs: 40
# 2) Heridxs - fecha de los hechos
df_heridxs_d2 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos, numero_de_heridos_as_total) %>%
group_by(fecha_de_los_hechos) %>%
summarise(total_heridxs = sum(numero_de_heridos_as_total, na.rm = T))
view(df_heridxs_d2)
# 3) Heridxs - municipios
df_heridxs_d3 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos, numero_de_heridos_as_total) %>%
group_by(municipio) %>%
summarise(total_heridxs = sum(numero_de_heridos_as_total, na.rm = T))
view(df_heridxs_d3)
##### Agresión -----
# 1) Heridxs - agresión: en general
df_agre_he1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_heridos_as_total, herido_a_pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "agresión") %>%
filter(numero_de_heridos_as_total >= "1") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_heridos = sum(numero_de_heridos_as_total, na.rm = T))
view(df_agre_he1)
# Total
sum(df_agre_he1$total_heridos) # total heridos - agresión: 31
# 2) He - agresión: fecha de hechos
df_agre_he2 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_heridos_as_total, herido_a_pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "agresión") %>%
filter(numero_de_heridos_as_total >= "1") %>%
group_by(fecha_de_los_hechos) %>%
summarise(total_heridos = sum(numero_de_heridos_as_total, na.rm = T))
view(df_agre_he2)
# 3) He - agresión: municipios
df_agre_he3 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_heridos_as_total, herido_a_pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "agresión") %>%
filter(numero_de_heridos_as_total >= "1") %>%
group_by(municipio) %>%
summarise(total_heridos = sum(numero_de_heridos_as_total, na.rm = T))
view(df_agre_he3)
##### Enfrentamiento -----
# 1) Heridxs - enfrentamiento: en general
df_enfren_he1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_heridos_as_total, herido_a_pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "enfrentamiento") %>%
filter(numero_de_heridos_as_total >= "1") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_heridos = sum(numero_de_heridos_as_total, na.rm = T))
# Total
sum(df_enfren_he1$total_heridos) # total heridos - enfrentamiento: 8
View(df_enfren_he1)
# 2) Heridxs - enfrentamiento: fecha de hechos
df_enfren_he2 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_heridos_as_total, herido_a_pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "enfrentamiento") %>%
filter(numero_de_heridos_as_total >= "1") %>%
group_by(fecha_de_los_hechos) %>%
summarise(total_heridos = sum(numero_de_heridos_as_total, na.rm = T))
View(df_enfren_he2)
# 3) Heridxs - enfrentamiento: municipios
df_enfren_he3 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_heridos_as_total, herido_a_pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "enfrentamiento") %>%
filter(numero_de_heridos_as_total >= "1") %>%
group_by(municipio) %>%
summarise(total_heridos = sum(numero_de_heridos_as_total, na.rm = T))
View(df_enfren_he3)
##### Arma blanca -----
# Heridxs - ataque con arma blanca: en general
df_armablanca_he1 <- df_ataque_desp %>%
select(municipio, fecha_de_los_hechos,
numero_de_heridos_as_total, herido_a_pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "ataque con arma blanca") %>%
filter(numero_de_heridos_as_total >= "1") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_heridos = sum(numero_de_heridos_as_total, na.rm = T))
sum(df_armablanca_he1$total_heridos) # total heridos - ataque con arma blanca: 1
#### Desparecidxs---------------------------------------------------------------
# 1) Desaparecidos: general
df_desaparecidos1 <- df_sonora_des %>%
select(municipio, fecha_de_los_hechos,
privacion_de_la_libertad, numero_de_personas_privadas_de_su_libertad) %>%
filter(privacion_de_la_libertad == "TRUE") %>%
filter(numero_de_personas_privadas_de_su_libertad >= "1") %>%
group_by(fecha_de_los_hechos, municipio) %>%
summarise(total_desaparecidos = sum(numero_de_personas_privadas_de_su_libertad, na.rm = T))
sum(df_desaparecidos1$total_desaparecidos) # desaparecido:98
View(df_desaparecidos1)
# 2) Desaparecidos - fecha de hechos
df_desaparecidos2 <- df_sonora_des %>%
select(municipio, fecha_de_los_hechos,
privacion_de_la_libertad, numero_de_personas_privadas_de_su_libertad) %>%
filter(privacion_de_la_libertad == "TRUE") %>%
filter(numero_de_personas_privadas_de_su_libertad >= "1") %>%
group_by(fecha_de_los_hechos) %>%
summarise(total_desaparecidos = sum(numero_de_personas_privadas_de_su_libertad, na.rm = T))
View(df_agre_d2)
prueba <- df_sonora_des %>%
select(municipio, fecha_de_los_hechos,
numero_de_homicidios_total, pertenece_a,
ataque_armado) %>%
filter(ataque_armado == "agresión") %>%
filter(numero_de_homicidios_total >= "1")
View(prueba)
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD
# Objetivo:                   Procesamiento de info para figuras
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          21 de agosto de 2022
# Última actualización:       21 de agosto de 2022
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, lubridate, zoo, ggtext, beepr)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("03_datos_limpios/"           , x)}
paste_fig <- function(x){paste0("04_figuras/quintero_chihuahua/", x)}
# 1. Cargar datos --------------------------------------------------------------
load(paste_inp("df_monitor_amplio.Rdata"))
# 2. Limpieza ------------------------------------------------------------------
df_limpio <- df_monitor_amplio              %>%
# Renombrar
mutate(year = year(fecha_de_los_hechos),
mes  = month(fecha_de_los_hechos),
semana = week(fecha_de_los_hechos)
) %>%
select(estado, year, mes, semana,
fecha      = fecha_de_los_hechos,
homicidios = numero_de_homicidios_total,
detenidos  = numero_de_detenidos_as_total,
heridos    = numero_de_heridos_as_total,
privadas   = numero_de_personas_privadas_de_su_libertad) %>%
# Agrupar para sacar el total por día por entidad
group_by(estado, fecha) %>%
summarise(across(where(is.numeric), ~sum(., na.rm = T)))        %>%
# Dejar solo entidades de interés
filter(str_detect(estado, "Chihuahua") | str_detect(estado, "Sonora")) %>%
# Cambiar a formato largo
pivot_longer(
cols      = c(homicidios:privadas),
names_to  = "evento",
values_to = "total") %>%
# Renombrar eventos
mutate(evento = case_when(
evento == "homicidios" ~ "Homicidios",
evento == "detenidos"  ~ "Personas detenidas",
evento == "heridos"    ~ "Personas heridas",
evento == "privadas"   ~ "Personas privadas de la libertad"),
total = as.integer(total),
arresto_caro     = if_else(fecha == as.Date("2022-07-15"), 1, 0),
asesinato_padres = if_else(fecha == as.Date("2022-06-20"), 1, 0),
jueves_negro     = if_else(fecha == as.Date("2022-08-11"), 1, 0)) %>%
# filter(total != 0) %>%
glimpse()
df_limpio_semana <- df_limpio       %>%
group_by(estado, semana, evento)  %>%
summarise(total = sum(total))
# 3. Figuras -------------------------------------------------------------------
## 3.0. Configuración de figuras -----------------------------------------------
# ---- Tema
tema <-  theme_bw() +
theme(
text             = element_text(family = "Fira Sans", color = "black"),
plot.title       = element_text(size = 12, face = "bold", hjust = 0.5, margin = margin(10,5,5,5), family="Fira Sans", color = "black"),
plot.subtitle    = element_text(size = 10, color = "#666666", hjust = 0.5, margin = margin(5, 5, 5, 5), family="Fira Sans"),
plot.caption     = element_text(hjust = .5, size = 6, family = "Fira Sans", color = "black"),
panel.grid       = element_line(linetype = 2),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.position  = "top",
legend.title     = element_text(size = 8, face = "bold", family="Fira Sans"),
legend.text      = element_text(size = 10, family="Fira Sans"),
axis.title.x     = element_text(size = 10, hjust = .5, margin = margin(1,1,1,1), family="Fira Sans"),
axis.title.y     = element_text(size = 10, hjust = .5, margin = margin(1,1,1,1), family="Fira Sans", angle = 90),
axis.text.y      = element_text(size = 8, family="Fira Sans", angle=0, hjust=1),
axis.text.x      = element_text(size = 8, family="Fira Sans", angle=0, hjust=.5),
strip.background = element_rect(fill="white", colour = NA),
strip.text.x     = element_text(size=9, family = "Fira Sans", face = "bold", color = "black"),
strip.text.y     = element_text(size=9, family = "Fira Sans", face = "bold", color = "black"))
# ---- Colores
# ---- Vectores de texto
v_caption <- "Fuente: Elaboracón propia con datos del Monitor-PPD 2022"
## 3.1. Sonora (Caro Quintero) -------------------------------------------------
# ---- Fecha de arresto de caro quintero
v_arresto <- unique(df_limpio$fecha[df_limpio$arresto_caro == 1])
# ---- Filtrar datos
df_data <- df_limpio %>% filter(str_detect(estado, "Sonora"),
!str_detect(evento, "detenidas"),
# !str_detect(evento, "heridas"),
fecha >= as.Date("2022-06-01"))
# ---- Visualización
ggplot(
# Datos
df_data,
# Coordenadas
aes(x = fecha, y = total, group = evento, color = evento)) +
facet_wrap(~evento, ncol = 1) +
# Geoms
geom_line() +
geom_point() +
geom_vline(xintercept = v_arresto, linetype = "dashed") +
annotate("text", x = v_arresto + 100000, y = 14,
# label = if_else(df_data$evento == "Homicidios", "Arresto de Caro Quintero", NA_character_),
label = "Arresto de Caro Quintero",
size = 3, family = "Fira Sans", color = "#666666", hjust = 0) +
# geom_vline(xintercept = as.Date("2022-07-15"), linetype = "dashed") +
# Etiquetas
labs(
title    = "Eventos delictivos ocurridos en Sonora",
subtitle = "Diario y por tipo de evento\n",
x = "",
y = "Número total de eventos\n",
color = "",
caption = v_caption
) +
# Escalas
# scale_y_continuous(breaks = seq(0, 15, 2)) +
# Tema
tema +
theme(legend.position = "none")
# ---- Guardar figura
ggsave(file = paste_fig("quintero.png"),
width = 6, height = 5)
df_data <- df_limpio %>% filter(str_detect(estado, "Sonora"),
# !str_detect(evento, "detenidas"),
!str_detect(evento, "heridas"),
fecha >= as.Date("2022-06-01"))
# ---- Visualización
ggplot(
# Datos
df_data,
# Coordenadas
aes(x = fecha, y = total, group = evento, color = evento)) +
facet_wrap(~evento, ncol = 1) +
# Geoms
geom_line() +
geom_point() +
geom_vline(xintercept = v_arresto, linetype = "dashed") +
annotate("text", x = v_arresto + 100000, y = 14,
# label = if_else(df_data$evento == "Homicidios", "Arresto de Caro Quintero", NA_character_),
label = "Arresto de Caro Quintero",
size = 3, family = "Fira Sans", color = "#666666", hjust = 0) +
# geom_vline(xintercept = as.Date("2022-07-15"), linetype = "dashed") +
# Etiquetas
labs(
title    = "Eventos delictivos ocurridos en Sonora",
subtitle = "Diario y por tipo de evento\n",
x = "",
y = "Número total de eventos\n",
color = "",
caption = v_caption
) +
# Escalas
# scale_y_continuous(breaks = seq(0, 15, 2)) +
# Tema
tema +
theme(legend.position = "none")
# ---- Guardar figura
ggsave(file = paste_fig("quintero.png"),
width = 6, height = 5)
df_data <- df_limpio %>% filter(str_detect(estado, "Sonora"),
!str_detect(evento, "detenidas"),
# !str_detect(evento, "heridas"),
fecha >= as.Date("2022-06-01"))
# ---- Visualización
ggplot(
# Datos
df_data,
# Coordenadas
aes(x = fecha, y = total, group = evento, color = evento)) +
facet_wrap(~evento, ncol = 1) +
# Geoms
geom_line() +
geom_point() +
geom_vline(xintercept = v_arresto, linetype = "dashed") +
annotate("text", x = v_arresto + 100000, y = 14,
# label = if_else(df_data$evento == "Homicidios", "Arresto de Caro Quintero", NA_character_),
label = "Arresto de Caro Quintero",
size = 3, family = "Fira Sans", color = "#666666", hjust = 0) +
# geom_vline(xintercept = as.Date("2022-07-15"), linetype = "dashed") +
# Etiquetas
labs(
title    = "Eventos delictivos ocurridos en Sonora",
subtitle = "Diario y por tipo de evento\n",
x = "",
y = "Número total de eventos\n",
color = "",
caption = v_caption
) +
# Escalas
# scale_y_continuous(breaks = seq(0, 15, 2)) +
# Tema
tema +
theme(legend.position = "none")
# ---- Guardar figura
ggsave(file = paste_fig("quintero.png"),
width = 6, height = 5)
df_data <- df_limpio %>% filter(str_detect(estado, "Sonora"),
!str_detect(evento, "detenidas"),
# !str_detect(evento, "heridas"),
fecha >= as.Date("2022-06-01"),
fecha <= as.Date("2022-08-31"))
ggplot(
# Datos
df_data,
# Coordenadas
aes(x = fecha, y = total, group = evento, color = evento)) +
facet_wrap(~evento, ncol = 1) +
# Geoms
geom_line() +
geom_point() +
geom_vline(xintercept = v_arresto, linetype = "dashed") +
annotate("text", x = v_arresto + 100000, y = 14,
# label = if_else(df_data$evento == "Homicidios", "Arresto de Caro Quintero", NA_character_),
label = "Arresto de Caro Quintero",
size = 3, family = "Fira Sans", color = "#666666", hjust = 0) +
# geom_vline(xintercept = as.Date("2022-07-15"), linetype = "dashed") +
# Etiquetas
labs(
title    = "Eventos delictivos ocurridos en Sonora",
subtitle = "Diario y por tipo de evento\n",
x = "",
y = "Número total de eventos\n",
color = "",
caption = v_caption
) +
# Escalas
# scale_y_continuous(breaks = seq(0, 15, 2)) +
# Tema
tema +
theme(legend.position = "none")
View(df_limpio)
View(df_data)
df_data <- df_limpio %>% filter(str_detect(estado, "Sonora"),
!str_detect(evento, "detenidas"),
!str_detect(evento, "Personas privadas de la libertad"),
# !str_detect(evento, "heridas"),
fecha >= as.Date("2022-06-01"),
fecha <= as.Date("2022-08-31"))
# ---- Visualización
ggplot(
# Datos
df_data,
# Coordenadas
aes(x = fecha, y = total, group = evento, color = evento)) +
facet_wrap(~evento, ncol = 1) +
# Geoms
geom_line() +
geom_point() +
geom_vline(xintercept = v_arresto, linetype = "dashed") +
annotate("text", x = v_arresto + 100000, y = 14,
# label = if_else(df_data$evento == "Homicidios", "Arresto de Caro Quintero", NA_character_),
label = "Arresto de Caro Quintero",
size = 3, family = "Fira Sans", color = "#666666", hjust = 0) +
# geom_vline(xintercept = as.Date("2022-07-15"), linetype = "dashed") +
# Etiquetas
labs(
title    = "Eventos delictivos ocurridos en Sonora",
subtitle = "Diario y por tipo de evento\n",
x = "",
y = "Número total de eventos\n",
color = "",
caption = v_caption
) +
# Escalas
# scale_y_continuous(breaks = seq(0, 15, 2)) +
# Tema
tema +
theme(legend.position = "none")
ggsave(file = paste_fig("quintero.png"),
width = 6, height = 5)
