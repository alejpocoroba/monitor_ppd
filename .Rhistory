x  == " La familia michoacana" ~ "La Familia Michoacana",
x  == "La empresa"  ~ "La Empresa",
x  == "Los Mexicles o Los Aztecas"  ~ "Los Mexicles",
x  == "banda de Los Platanitos"  ~ "Banda de Los Platanitos",
x  == "La unión de los fantasmas" ~ "La Unión de los Fantasmas",
x  == "Cártel del Abuelo Farías" ~ "Cártel de Tepalcatepec",
x  == "cártel de Tepalcatepec" ~ "Cártel de Tepalcatepec",
x  == " cártel de Tepalcatepec" ~ "Cártel de Tepalcatepec",
x  == "Escuadro de la Muerte" ~ "Escuadrón de la Muerte",
x  == "“El Abuelo”" ~ "Cártel de Tepalcatepec",
x  == "Guardia Guerrerense, antes Templarios." ~ "Guardia Guerrerense",
x  == "‘Los Tarzanes’ o ‘Los Sinaloa’" ~ "Los Sinaloa",
x  == "\"La Reina de los Sinaloas\"" ~ "Los Sinaloa",
x  == "alias \"El Mayo\"" ~ "Cártel de Sinaloa",
x  == "grupo del Chapos Trini" ~ "Cártel de Sinaloa",
x  == "cártel de Sinaloa Facción Mayo Zambada" ~ "Cártel de Sinaloa",
x  == "Mayo Zambada" ~ "Cártel de Sinaloa",
x  == "Los Chapos Trinis" ~ "Cártel de Sinaloa",
x  == "cártel del pacífico" ~ "Cártel de Sinaloa",
x  == "Los Chapitos" ~ "Cártel de Sinaloa / Los Chapitos",
x  == "	La Chapiza"  ~ "Cártel de Sinaloa / Los Chapitos",
x  == "La Chapiza" ~ "Cártel de Sinaloa / Los Chapitos",
x  == "grupo El Jale Azul / El Sargento Huracán" ~ "Grupo El Jale Azul",
x  == "Escorpiones" ~ "Grupo Scorpion",
x  == "La Plaza" ~ "Cártel La Plaza",
x  == "los viagras" ~ "Los Viagras",
x  == " Los Viagras" ~ "Los Viagras",
x  == "Los correa" ~ "Cártel de los Correa",
x  == "Los Correa" ~ "Cártel de los Correa",
x  == " Los correa" ~ "Cártel de los Correa",
x  == "cártel de Los Correa" ~ "Cártel de los Correa",
x  == "“El Tigre” Correa, líder máximo del cártel que lleva el apellidos de la familia" ~ "Cártel de los Correa",
x  == " Célula delictiva del Mamer" ~ "Grupo del Mamer",
x  == " los caballeros templarios" ~ "Caballeros Templarios",
x  == " Los Caballeros Templarios" ~ "Caballeros Templarios",
x  == "Específicamente el Grupo X que encabeza el líder delincuencial conocido como “El barbas”." ~ "Grupo X de El Barbas",
x  == "Familia Caro Páez" ~ "Cártel de Caborca",
x  == "Gente del Tigre" ~ "Gente Nueva del Tigre",
x  == "Gente Nueva de Sonora" ~ "Gente Nueva",
x  == "Gente Nuevo" ~ "Gente Nueva",
x  == "Gente Nueva Los Paredes" ~ "Los Paredes",
x  == "Los Artistas Asesinos" ~ "Artistas Asesinos",
x  == "Tlacos del Cártel de la Sierra" ~ "Cártel de la Sierra",
x  == " Cártel Sangre Nueva Zeta" ~ "Sangre Nueva Zeta",
x  == "GDC" ~ "Gente Del Chaparrito (GDC)",
x  == "Los maseros" ~ "Los Maseros",
x  == "banda delictiva de “El Malverde”" ~ "Banda de El Malverde",
x  == "El pueblo" ~ "El Pueblo",
x  == "	la mera verga" ~ "La Mera Verga",
x  == "Nueva alianza" ~ "Nueva Alianza",
x  == x ~ x
)
}
df_limpia <- df_nombres %>%
# Crear variables con tipo de clasificación
mutate(across(starts_with("grupo"), ~clasificar_grupos(.))) %>%
# Limpiar nombres específicos de grupos criminales
mutate(across(starts_with("grupo"), ~limpiar_grupos(.)))  %>%
# Quitar espacios en blanco al inicio y final (función trimws)
mutate(across(starts_with("grupo"), ~trimws(.))) %>%
# Quitar observaciones que solo tienen un punto (".")
mutate(across(starts_with("grupo"), ~if_else(. == ".", NA_character_, .))) %>%
mutate(across(starts_with("grupo"), ~if_else(. == "na", NA_character_, .))) %>%
# Convertir autodefensas, alias y guardia civil a NAs
mutate(across(starts_with("grupo"), ~if_else(. %in% c("autodefensas",
"alias",
"grupo armado"),
NA_character_, .)))  %>%
# Rivales
mutate(across(starts_with("rival"), ~clasificar_grupos(.))) %>%
mutate(across(starts_with("rival"), ~limpiar_grupos(.)))  %>%
mutate(across(starts_with("rival"), ~trimws(.))) %>%
mutate(across(starts_with("rival"), ~if_else(. == ".", NA_character_, .))) %>%
mutate(across(starts_with("rival"), ~if_else(. == "na", NA_character_, .))) %>%
mutate(across(starts_with("rival"), ~if_else(. %in% c("autodefensas",
"alias",
"grupo armado"),
NA_character_, .)))  %>%
# Alianzas
mutate(across(starts_with("alianza"), ~clasificar_grupos(.))) %>%
mutate(across(starts_with("alianza"), ~limpiar_grupos(.)))  %>%
mutate(across(starts_with("alianza"), ~trimws(.))) %>%
mutate(across(starts_with("alianza"), ~if_else(. == ".", NA_character_, .))) %>%
mutate(across(starts_with("alianza"), ~if_else(. == "na", NA_character_, .))) %>%
mutate(across(starts_with("alianza"), ~if_else(. %in% c("autodefensas",
"alias",
"grupo armado"),
NA_character_, .)))
limpiar_grupos <- function(x){
case_when(
x  == "‘La Línea’ o Nuevo Cártel de Juárez (NCDJ)" ~ "La Línea",
x  == "La Línea o Cártel de Juárez" ~ "La Línea",
x  == " La Línea" ~ "La Línea",
x  == "Grupo Delta/Gente Nueva"  ~ "Grupo Delta",
x  == "Grupo de Huachicol del Pelón del Sur" ~ "Banda del Pelón del Sur",
x  == "El Pelón del Sur" ~ "Banda del Pelón del Sur",
x  == "Los capetos"  ~ "Los Capetos",
x  == "Gente Nueva de los Salazar"  ~ "Los Salazar",
x  == "Gente Nueva Salazar"  ~ "Los Salazar",
x  == "La banda de “El Negro”"  ~ "Banda de El Negro",
x  == "banda delictiva de “Los Chinos”"  ~ "Los Chinos",
x  == "Los salazar"  ~ "Los Salazar",
x  == "Los Salazares"  ~ "Los Salazar",
x  == "Los Salazares"  ~ "Los Salazar",
x  == "Cártel Jalisco"  ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == " Cártel Jalisco Nueva Generación"  ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == " CJNG"  ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == "CJNG"  ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == "CJNG" ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == " El Cártel Jalisco Nueva Generación"  ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == "cártel Jalisco Nueva Generación" ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == "Cártel Jalisco Nueva Generación"  ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == "el Cantinflas; CJNG"  ~ "Cártel Jalisco Nueva Generación (CJNG)",
x  == " Cártel Jalisco Nueva Generación" ~ "Cártel Jalisco Nueva Generación (CJNG)",
# x  == "CJGN "Fuerzas especiales del Mencho" ~ "Fuerzas Especiales del Mencho",
x  == "Los pájaros sierra"  ~ "Pájaros Sierra",
x  == " líder de Pájaros Sierra"  ~ "Pájaros Sierra",
x  == "Cártel Los Alemanes de Los Zetas" ~ "Cártel Los Alemanes",
x  == "Cártel Lo Alemanes de Los Zetas" ~ "Cártel Los Alemanes",
x  == "Cártel de Los Alemanes" ~ "Cártel Los Alemanes",
x  == "banda \"La bolsa negra\""  ~ "Grupo La Bolsa Negra",
x  == "'El Víbora', presunto lugarteniente de 'El Bukanas'"  ~ "Grupo de El Bukanas",
x  == " El Bukanas"  ~ "Grupo de El Bukanas",
x  == "'El Loco Téllez'"  ~ "Grupo de El Loco Téllez",
x  == "El Loco Téllez"  ~ "Grupo de El Loco Téllez",
x  == " Célula Delictiva del Loco Téllez"  ~ "Grupo de El Loco Téllez",
x  == "gente de \"El Grillo\""  ~ "Banda de El Grillo",
x  == "banda de “Los Cucos”"  ~ "Banda de Los Cucos",
x  == "Cártel Arellano Félix"  ~ "Cártel de Los Arellano Félix",
x  == "Juan Antonio \"N\", alias \"Mares\" o \"Tambor\"; parte de una célula de integrantes remanentes del CSRDL"  ~ "Cártel de Santa Rosa de Lima",
x  == " parte de una célula de integrantes remanentes del CSRDL"  ~ "Cártel de Santa Rosa de Lima",
x  == "Cártel de H. Matamoros"  ~ "Cártel del Golfo",
x  == "“Los Lampones\""  ~ "Los Lampones",
x  == "Unión Tepito"  ~ "La Unión Tepito",
x  == "La familia Michoacana"  ~ "La Familia Michoacana",
x  == " La Familia Michoacana"  ~ "La Familia Michoacana",
x  == " Familia Michacana"  ~ "La Familia Michoacana",
x  == " Familia Michoacana"  ~ "La Familia Michoacana",
x  == "La familia michoacana" ~ "La Familia Michoacana",
x  == "La familia michoacana" ~ "La Familia Michoacana",
x  == " La familia michoacana" ~ "La Familia Michoacana",
x  == "La empresa"  ~ "La Empresa",
x  == "Los Mexicles o Los Aztecas"  ~ "Los Mexicles",
x  == "banda de Los Platanitos"  ~ "Banda de Los Platanitos",
x  == "La unión de los fantasmas" ~ "La Unión de los Fantasmas",
x  == "Cártel del Abuelo Farías" ~ "Cártel de Tepalcatepec",
x  == "cártel de Tepalcatepec" ~ "Cártel de Tepalcatepec",
x  == " cártel de Tepalcatepec" ~ "Cártel de Tepalcatepec",
x  == "Escuadro de la Muerte" ~ "Escuadrón de la Muerte",
x  == "“El Abuelo”" ~ "Cártel de Tepalcatepec",
x  == "Guardia Guerrerense, antes Templarios." ~ "Guardia Guerrerense",
x  == "‘Los Tarzanes’ o ‘Los Sinaloa’" ~ "Los Sinaloa",
x  == "\"La Reina de los Sinaloas\"" ~ "Los Sinaloa",
x  == "alias \"El Mayo\"" ~ "Cártel de Sinaloa",
x  == "grupo del Chapos Trini" ~ "Cártel de Sinaloa",
x  == "cártel de Sinaloa Facción Mayo Zambada" ~ "Cártel de Sinaloa",
x  == "Mayo Zambada" ~ "Cártel de Sinaloa",
x  == "Los Chapos Trinis" ~ "Cártel de Sinaloa",
x  == "cártel del pacífico" ~ "Cártel de Sinaloa",
x  == "Los Chapitos" ~ "Cártel de Sinaloa / Los Chapitos",
x  == "	La Chapiza"  ~ "Cártel de Sinaloa / Los Chapitos",
x  == "La Chapiza" ~ "Cártel de Sinaloa / Los Chapitos",
x  == "grupo El Jale Azul / El Sargento Huracán" ~ "Grupo El Jale Azul",
x  == "Escorpiones" ~ "Grupo Scorpion",
x  == "La Plaza" ~ "Cártel La Plaza",
x  == "los viagras" ~ "Los Viagras",
x  == " Los Viagras" ~ "Los Viagras",
x  == "Los correa" ~ "Cártel de los Correa",
x  == "Los Correa" ~ "Cártel de los Correa",
x  == " Los correa" ~ "Cártel de los Correa",
x  == "cártel de Los Correa" ~ "Cártel de los Correa",
x  == "“El Tigre” Correa, líder máximo del cártel que lleva el apellidos de la familia" ~ "Cártel de los Correa",
x  == " Célula delictiva del Mamer" ~ "Grupo del Mamer",
x  == " los caballeros templarios" ~ "Caballeros Templarios",
x  == " Los Caballeros Templarios" ~ "Caballeros Templarios",
x  == "Específicamente el Grupo X que encabeza el líder delincuencial conocido como “El barbas”." ~ "Grupo X de El Barbas",
x  == "Familia Caro Páez" ~ "Cártel de Caborca",
x  == "Gente del Tigre" ~ "Gente Nueva del Tigre",
x  == "Gente Nueva de Sonora" ~ "Gente Nueva",
x  == "Gente Nuevo" ~ "Gente Nueva",
x  == "Gente Nueva Los Paredes" ~ "Los Paredes",
x  == "Los Artistas Asesinos" ~ "Artistas Asesinos",
x  == "Tlacos del Cártel de la Sierra" ~ "Cártel de la Sierra",
x  == " Cártel Sangre Nueva Zeta" ~ "Sangre Nueva Zeta",
x  == "GDC" ~ "Gente Del Chaparrito (GDC)",
x  == "Los maseros" ~ "Los Maseros",
x  == "banda delictiva de “El Malverde”" ~ "Banda de El Malverde",
x  == "El pueblo" ~ "El Pueblo",
x  == "	la mera verga" ~ "La Mera Verga",
x  == "la mera verga" ~ "La Mera Verga",
x  == "Nueva alianza" ~ "Nueva Alianza",
x  == x ~ x
)
}
df_limpia <- df_nombres %>%
# Crear variables con tipo de clasificación
mutate(across(starts_with("grupo"), ~clasificar_grupos(.))) %>%
# Limpiar nombres específicos de grupos criminales
mutate(across(starts_with("grupo"), ~limpiar_grupos(.)))  %>%
# Quitar espacios en blanco al inicio y final (función trimws)
mutate(across(starts_with("grupo"), ~trimws(.))) %>%
# Quitar observaciones que solo tienen un punto (".")
mutate(across(starts_with("grupo"), ~if_else(. == ".", NA_character_, .))) %>%
mutate(across(starts_with("grupo"), ~if_else(. == "na", NA_character_, .))) %>%
# Convertir autodefensas, alias y guardia civil a NAs
mutate(across(starts_with("grupo"), ~if_else(. %in% c("autodefensas",
"alias",
"grupo armado"),
NA_character_, .)))  %>%
# Rivales
mutate(across(starts_with("rival"), ~clasificar_grupos(.))) %>%
mutate(across(starts_with("rival"), ~limpiar_grupos(.)))  %>%
mutate(across(starts_with("rival"), ~trimws(.))) %>%
mutate(across(starts_with("rival"), ~if_else(. == ".", NA_character_, .))) %>%
mutate(across(starts_with("rival"), ~if_else(. == "na", NA_character_, .))) %>%
mutate(across(starts_with("rival"), ~if_else(. %in% c("autodefensas",
"alias",
"grupo armado"),
NA_character_, .)))  %>%
# Alianzas
mutate(across(starts_with("alianza"), ~clasificar_grupos(.))) %>%
mutate(across(starts_with("alianza"), ~limpiar_grupos(.)))  %>%
mutate(across(starts_with("alianza"), ~trimws(.))) %>%
mutate(across(starts_with("alianza"), ~if_else(. == ".", NA_character_, .))) %>%
mutate(across(starts_with("alianza"), ~if_else(. == "na", NA_character_, .))) %>%
mutate(across(starts_with("alianza"), ~if_else(. %in% c("autodefensas",
"alias",
"grupo armado"),
NA_character_, .)))
dim(df_crudo)
dim(df_limpia)
v_grupos <- unique(
c(df_nombres$grupo1, df_nombres$grupo2 , df_nombres$grupo3 , df_nombres$grupo4,
df_nombres$grupo5, df_nombres$grupo6 , df_nombres$grupo7 , df_nombres$grupo8,
df_nombres$grupo9, df_nombres$grupo10, df_nombres$grupo11,
df_nombres$rival1, df_nombres$rival2, df_nombres$rival3,
df_nombres$alianza1, df_nombres$alianza2, df_nombres$alianza3,
df_nombres$alianza4, df_nombres$alianza5, df_nombres$alianza6))
v_grupos_limpios <- unique(
c(df_limpia$grupo1  , df_limpia$grupo2,
df_limpia$grupo3  , df_limpia$grupo4,
df_limpia$grupo5  , df_limpia$grupo6,
df_limpia$grupo7  , df_limpia$grupo8,
df_limpia$grupo9  , df_limpia$grupo10,
df_limpia$grupo11 , df_limpia$rival1,
df_limpia$rival2  , df_limpia$rival3,
df_limpia$alianza1, df_limpia$alianza2,
df_limpia$alianza3, df_limpia$alianza4,
df_limpia$alianza5, df_limpia$alianza6))
df_larga <- df_limpia %>%
select(id, fecha = fecha_de_publicacion, estado, starts_with("grupo")) %>%
pivot_longer(cols = c(starts_with("grupo"), starts_with("alianza"), starts_with("rival")),
names_to  = "num",
values_to = "grupo") %>%
drop_na(grupo)
# ---- Número de grupos: 125
length(unique(df_larga$grupo))
df_larga <- df_limpia %>%
select(fecha = fecha_de_publicacion, estado, starts_with("grupo")) %>%
pivot_longer(cols = c(starts_with("grupo"), starts_with("alianza"), starts_with("rival")),
names_to  = "num",
values_to = "grupo") %>%
drop_na(grupo)
# ---- Número de grupos: 125
length(unique(df_larga$grupo))
lista_grupos2022 <- data.frame(unique(df_larga$grupo))
lista_grupos2023 <- data.frame(unique(df_larga$grupo))
View(lista_grupos2023)
df_grupos0 <- df_larga %>%
# variables de interés
select(estado, grupo) %>%
group_by(estado, grupo) %>%
summarize(total_grupos = n()) %>%
drop_na(grupo) %>%
group_by(estado) %>%
summarize(total_grupos = n()) %>%
drop_na(estado)
View(df_grupos0)
df_grupos <- df_grupos0 %>%
bind_rows(estados_faltan) %>%
mutate(region = str_sub(estado, -2, -1)) %>%
left_join(mxstate.map, by = "region")
# plot
ggplot(
# Datos
df_grupos,
# Coordenadas
aes(long, lat, group = group, fill = total_grupos)) +
coord_map() +
geom_polygon(color = "black", size = .2, show.legend = T, alpha = 1) +
labs(title = "Presencia criminal en México",
subtitle = "Junio - Diciembre 2022\n",
fill = "Número",
caption = "Fuente: Monitor-PPD (2022)") +
scale_fill_gradient(low = "#7FCCA1", high = "#193F29", na.value = "white",
breaks = seq(0, 40, 10)) +
# Tema
tema +
# Quitar fondo al mapa
theme(axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
panel.background = element_rect(fill = "white", colour = NA)) +
# Ampliar largo de la barra
theme(legend.key.size = unit(0.5, "cm"),
legend.key.width = unit(1,"cm"))
df_grupos0 %>%
bind_rows(estados_faltan) %>%
mutate(region = str_sub(estado, -2, -1)) %>%
left_join(mxstate.map, by = "region")
estados_faltan <- data.frame("estado" = c("Coahuila-05", "Hidalgo-13", "Oaxaca-20",
"Querétaro-22", "Tlaxcala-29", "Yucatán-31", "Zacatecas-32"),
"total_grupos" =  NA_real_)
df_grupos <- df_grupos0 %>%
bind_rows(estados_faltan) %>%
mutate(region = str_sub(estado, -2, -1)) %>%
left_join(mxstate.map, by = "region")
# plot
ggplot(
# Datos
df_grupos,
# Coordenadas
aes(long, lat, group = group, fill = total_grupos)) +
coord_map() +
geom_polygon(color = "black", size = .2, show.legend = T, alpha = 1) +
labs(title = "Presencia criminal en México",
subtitle = "Enero - Febrero 2023\n",
fill = "Número",
caption = "Fuente: Monitor-PPD (2023)") +
scale_fill_gradient(low = "#7FCCA1", high = "#193F29", na.value = "white",
breaks = seq(0, 40, 10)) +
# Tema
tema +
# Quitar fondo al mapa
theme(axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
panel.background = element_rect(fill = "white", colour = NA)) +
# Ampliar largo de la barra
theme(legend.key.size = unit(0.5, "cm"),
legend.key.width = unit(1,"cm"))
ggsave(file = paste_fig("map_grupos.png"), width = 10, height = 6)
df_grupos2 <- df_larga %>%
select(estado, grupo) %>%
group_by(estado, grupo) %>%
summarize(total_grupos = n()) %>%
drop_na(grupo) %>%
group_by(grupo) %>%
summarize(total_grupos = n())
View(df_grupos2)
View(df_grupos0)
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD 2023
# Objetivo:                   Reporte de desempeño: captura de notas
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          19 de enero de 2023
# Última actualización:       30 de marzo de 2023
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD versión 2023
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("02_datos_crudos/" , x)}
paste_out <- function(x){paste0("03_datos_limpios/", x)}
paste_fig <- function(x){paste0("04_figuras/"      , x)}
# 1. Cargar datos --------------------------------------------------------------
# Enero - marzo 2023
a <- read_xlsx(paste_inp("Monitor_PPD_01_02.23.xlsx"))
b <- read_xlsx(paste_inp("Monitor_PPD_03.xlsx")) # al 24/03
# Se unen bases
m1 <- a %>%
bind_rows(b)
# 2. Procesamiento
# limpiar nombres de microdatos
df_ <- m1 %>%
janitor::clean_names() %>%
select("responsable" = "x1_1_responsable",
"publicacion" = "x1_2_1_fecha_publicacion",
"estado"      = "x1_3_2_estado") %>%
# modificaciones sobre fecha: mes
mutate(mes = lubridate::month(publicacion)) %>%
mutate(
id_entidad = str_extract_all(estado, "[:digit:]"))
# 3. Cifras de captura ---------------------------------------------------
## Periodo junio a noviembre----
# Total de observaciones
paste0("Número total de observaciones entre enero y marzo 2023: ", dim(df_)[1])
# Total de obsveraciones por mes
table(df_$mes)
# Total de observaciones por responsable
table(df_$responsable)
# Porcentajes
# Porcentaje por responsable
df_responsable <- df_ %>%
group_by(responsable) %>%
summarise(notas = n()) %>%
ungroup() %>%
mutate(
porcentaje = round(notas/sum(notas), 4),
porcentaje_text = scales::percent(porcentaje, accuracy = 0.01))
# Porcentje por responsable y mes
df_responsable_mes <- df_ %>%
group_by(mes, responsable) %>%
summarise(notas = n()) %>%
ungroup() %>%
group_by(mes) %>%
mutate(
porcentaje = round(notas/sum(notas), 4),
porcentaje_text = scales::percent(porcentaje, accuracy = 0.01))
# Porcentaje por estado
df_entidad<- df_ %>%
group_by(estado) %>%
summarise(notas = n()) %>%
ungroup() %>%
mutate(
porcentaje = round(notas/sum(notas), 4),
porcentaje_text = scales::percent(porcentaje, accuracy = 0.01))
# 4. Figuras-----
## Capturas general----
# procesamiento
df_data1 <- df_ %>%
group_by(publicacion, estado, responsable) %>%
summarise(
total = n()) %>%
filter(!is.na(estado)) %>%
drop_na()  %>%
# Agregar variable de mes para facilitar filtros de fechas
mutate(mes = lubridate::month(publicacion, label = TRUE))
# Por estado, publicación y responsable
ggplot(
# Datos
df_data1,
# Coordenadas
aes(x = publicacion, y = total, fill = responsable)) +
facet_wrap(~estado, ncol = 8) +
# Geoms
geom_col() +
# Etiquetas
labs(
title = "Total de observaciones capturadas para el Monitor PPD en 2023",
subtitle = "Por estado, fecha de publicación y persona responsable",
fill = "Persona\nresponsable\n",
x = "Fecha de publicación",
y = "\nNúmero de observaciones capturadas",
caption = paste0("Fuente: Monitor-PPD al 30/03/23 ")
) +
# Escalas
scale_fill_brewer(palette="Set2") +
# Temas
theme_bw() +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 30))
ggsave(file = paste_fig("01_captura_general_2023.png"),
width = 10, height = 6)
# Meses - 2023
## Captura desagregado----
# Procesamiento
for(i in 1:3) {
df_data <- df_ %>%
filter(mes == i) %>%
group_by(publicacion, estado, responsable) %>%
summarise(
total = n()
) %>%
filter(!is.na(estado)) %>%
drop_na()
# Por día, mes, estado y responsable
ggplot(
# Datos
df_data,
# Coordenadas
aes(x = publicacion, y = total, fill = responsable)) +
facet_wrap(~estado, ncol = 8) +
# Geoms
geom_col() +
# Etiquetas
labs(
title = paste0("Total de observaciones capturadas por mes ", i),
subtitle = "Por estado, fecha de publicación y persona responsable",
fill = "Persona\nresponsable\n",
x = "Fecha de publicación",
y = "\nNúmero de observaciones capturadas",
caption = paste0("Fuente: Monitor-PPD al 30/03/23 ")
) +
# Escalas
scale_fill_brewer(palette="Set2") +
# Tema
theme_bw() +
theme(
legend.position = "top",
axis.text.x = element_text(angle = 30))
ggsave(file = paste_fig(paste0("02_captura_estado_fecha_persona_", i, ".png")),
width = 10, height = 6)
}
