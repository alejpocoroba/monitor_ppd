axis.text.x = element_text(angle = 30))
ggsave(file = paste_fig("04_captura_06_2023.png"),
width = 10, height = 6)
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD 2023
# Objetivo:                   Reporte de desempeño: captura de notas
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          01 de agosto de 2023
# Última actualización:       01 de agosto de 2023
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD versión abril - junio 2023
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr, lubridate)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("02_datos_crudos/" , x)}
paste_out <- function(x){paste0("03_datos_limpios/", x)}
paste_fig <- function(x){paste0("04_figuras/"      , x)}
# 1. Cargar datos --------------------------------------------------------------
# junio 01 de 2023
c <- read_xlsx(paste_inp("monitor_abril_2023.xlsx"))
b <- read_xlsx(paste_inp("monitor_junio_2023.xlsx"))
d <- read_xlsx(paste_inp("monitor_marzo_2023.xlsx"))
# Se unen bases
a <- c %>%
bind_rows(b) %>%
bind_rows(d)
# 2. Procesamiento -------------------------------------------------------------
View(a)
colnames(a)
crudo <- a %>%
select(responsable:observaciones)
View(crudo)
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr)
crudo <- a %>%
janitor::clean_names() %>%
select(responsable:observaciones)
crudo <- a %>%
janitor::clean_names() %>%
select(estado:observaciones)
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD 2023
# Objetivo:                   Reporte de desempeño: captura de notas
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          01 de agosto de 2023
# Última actualización:       01 de agosto de 2023
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD versión abril - junio 2023
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("02_datos_crudos/" , x)}
paste_out <- function(x){paste0("03_datos_limpios/", x)}
paste_fig <- function(x){paste0("04_figuras/"      , x)}
# 1. Cargar datos --------------------------------------------------------------
c <- read_xlsx(paste_inp("monitor_abril_2023.xlsx"))
b <- read_xlsx(paste_inp("monitor_junio_2023.xlsx"))
d <- read_xlsx(paste_inp("monitor_marzo_2023.xlsx"))
# Se unen bases
a <- c %>%
bind_rows(b) %>%
bind_rows(d)
# 2. Procesamiento -------------------------------------------------------------
# Limpieza de nombres y variables de interés
crudo <- a %>%
janitor::clean_names() %>%
select(estado:observaciones)
colnames(crudo)
crudo$"fecha" <- as.Date(df_$"fecha")
crudo$dia <- format(df_$"fecha", "%d")
crudo$mes <- format(df_$"fecha", "%m")
crudo$anio <- format(df_$"fecha", "%Y")
crudo$"fecha" <- as.Date(crudo$"fecha")
crudo$dia     <- format(crudo$"fecha", "%d")
crudo$mes     <- format(crudo$"fecha", "%m")
crudo$anio    <- format(crudo$"fecha", "%Y")
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -6, -5),
clavefinal = str_remove_all(str_sub(estado, -6, -1), "[:punct:]"))
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -7, -5),
clavefinal = str_remove_all(str_sub(estado, -6, -1), "[:punct:]"))
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -5, -5),
clavefinal = str_remove_all(str_sub(estado, -6, -1), "[:punct:]"))
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -6, -5))
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -1, -1))
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -5, -1))
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -3, -1))
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -2, -1))
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD 2023
# Objetivo:                   Reporte de desempeño: captura de notas
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          01 de agosto de 2023
# Última actualización:       01 de agosto de 2023
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD versión abril - junio 2023
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("02_datos_crudos/" , x)}
paste_out <- function(x){paste0("03_datos_limpios/", x)}
paste_fig <- function(x){paste0("04_figuras/"      , x)}
# 1. Cargar datos --------------------------------------------------------------
c <- read_xlsx(paste_inp("monitor_abril_2023.xlsx"))
b <- read_xlsx(paste_inp("monitor_junio_2023.xlsx"))
d <- read_xlsx(paste_inp("monitor_marzo_2023.xlsx"))
# Se unen bases
a <- c %>%
bind_rows(b) %>%
bind_rows(d)
# 2. Procesamiento -------------------------------------------------------------
# Limpieza de nombres y variables de interés
crudo <- a %>%
janitor::clean_names() %>%
select(estado:observaciones)
# Tratamiento de fechas #
crudo$"fecha" <- as.Date(crudo$"fecha")
crudo$dia     <- format(crudo$"fecha", "%d")
crudo$mes     <- format(crudo$"fecha", "%m")
crudo$anio    <- format(crudo$"fecha", "%Y")
# Estado según su clave de Inegi
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -2, -1))
View(crudo)
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD 2023
# Objetivo:                   Reporte de desempeño: captura de notas
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          01 de agosto de 2023
# Última actualización:       01 de agosto de 2023
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD versión abril - junio 2023
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("02_datos_crudos/" , x)}
paste_out <- function(x){paste0("03_datos_limpios/", x)}
paste_fig <- function(x){paste0("04_figuras/"      , x)}
# 1. Cargar datos --------------------------------------------------------------
c <- read_xlsx(paste_inp("monitor_abril_2023.xlsx"))
b <- read_xlsx(paste_inp("monitor_junio_2023.xlsx"))
d <- read_xlsx(paste_inp("monitor_marzo_2023.xlsx"))
# Se unen bases
a <- c %>%
bind_rows(b) %>%
bind_rows(d)
# 2. Procesamiento -------------------------------------------------------------
# Limpieza de nombres y variables de interés
crudo <- a %>%
janitor::clean_names() %>%
select(estado:observaciones)
# Tratamiento de fechas #
crudo$"fecha" <- as.Date(crudo$"fecha")
crudo$dia     <- format(crudo$"fecha", "%d")
crudo$mes     <- format(crudo$"fecha", "%m")
crudo$anio    <- format(crudo$"fecha", "%Y")
# Estado según su clave de Inegi
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -2, -1))
# Limpiar T/F por 1/0
limpiar_tf <- funcion(x){
case_when(
x == "FALSE" ~ "0"
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
limpiar_tf <- funcion(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr)
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
colnames(crudo)
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD 2023
# Objetivo:                   Reporte de desempeño: captura de notas
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          01 de agosto de 2023
# Última actualización:       01 de agosto de 2023
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD versión abril - junio 2023
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("02_datos_crudos/" , x)}
paste_out <- function(x){paste0("03_datos_limpios/", x)}
paste_fig <- function(x){paste0("04_figuras/"      , x)}
# 1. Cargar datos --------------------------------------------------------------
c <- read_xlsx(paste_inp("monitor_abril_2023.xlsx"))
b <- read_xlsx(paste_inp("monitor_junio_2023.xlsx"))
d <- read_xlsx(paste_inp("monitor_marzo_2023.xlsx"))
# Se unen bases
a <- c %>%
bind_rows(b) %>%
bind_rows(d)
# 2. Procesamiento -------------------------------------------------------------
# Limpieza de nombres y variables de interés
crudo <- a %>%
janitor::clean_names() %>%
select(estado:observaciones)
# Tratamiento de fechas #
crudo$"fecha" <- as.Date(crudo$"fecha")
crudo$dia     <- format(crudo$"fecha", "%d")
crudo$mes     <- format(crudo$"fecha", "%m")
crudo$anio    <- format(crudo$"fecha", "%Y")
# Estado según su clave de Inegi
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -2, -1))
# Limpiar T/F por 1/0
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
class(crudo$violencia_armade_fuego)
crudo$violencia_armade_fuego <- as.character(crudo$violencia_armade_fuego)
crudo$homicidios <- as.character(crudo$homicidios)
crudo$heridxs <- as.character(crudo$heridxs)
crudo$genero <- as.character(crudo$genero)
crudo$presencia_criminal <- as.character(crudo$presencia_criminal)
crudo$actividades_delictivas <- as.character(crudo$actividades_delictivas)
crudo$detenciones <- as.character(crudo$detenciones)
crudo$acciones_gubernamentales <- as.character(crudo$acciones_gubernamentales)
crudo$politica_seguridad <- as.character(crudo$politica_seguridad)
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
crudo <- crudo %>%
mutate_at(.vars = c("otra", "observaciones"),
.funs = ~str_to_lower(.))
crudo$otra          <- stri_trans_general(crudo$otra, "Latin-ASCII")
crudo$observaciones <- stri_trans_general(crudo$observaciones, "Latin-ASCII")
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr, lubridate, stringr, janitor, stringi)
crudo <- crudo %>%
mutate_at(.vars = c("otra", "observaciones"),
.funs = ~str_to_lower(.))
# acentos
crudo$otra          <- stri_trans_general(crudo$otra, "Latin-ASCII")
crudo$observaciones <- stri_trans_general(crudo$observaciones, "Latin-ASCII")
table(crudo$otra)
x <- as.data.frame(table(crudo$otra))
openxlsx::write.xlsx(x,
file = paste_out("otra.xlsx"))
crudo_otra <- crudo %>%
mutate(otra = str_replace_all(otra, "/", ";"),
otra = str_replace_all(otra, ":", ";"),
crudo_otra = str_count(otra, ";")) %>%
select(crudo_otra)
View(crudo_otra)
crudo_otra1 <- crudo %>%
mutate(otra = str_replace_all(otra, "/", ";"),
otra = str_remove_all(otra, ":", ";")) %>%
separate(otra, sep = ";", c("otra1", "otra2","otra3"))
crudo_otra1 <- crudo %>%
mutate(otra = str_replace_all(otra, "/", ";"),
otra = str_replace_all(otra, ":", ";")) %>%
separate(otra, sep = ";", c("otra1", "otra2","otra3"))
View(crudo_otra1)
x <- as.data.frame(table(crudo$crudo_otra1))
openxlsx::write.xlsx(x,
file = paste_out("otra.xlsx"))
openxlsx::write.xlsx(crudo_otra1,
file = paste_out("otra.xlsx"))
x <- as.data.frame(table(crudo$crudo_otra1))
z <- as.data.frame(table(crudo$crudo_otra2))
w <- as.data.frame(table(crudo$crudo_otra3))
x <- as.data.frame(table(crudo_otra1$otra1))
z <- as.data.frame(table(crudo_otra1$otra2))
w <- as.data.frame(table(crudo_otra1$otra3))
View(w)
View(x)
openxlsx::write.xlsx(x,
file = paste_out("otra1.xlsx"))
openxlsx::write.xlsx(z,
file = paste_out("otra2.xlsx"))
openxlsx::write.xlsx(w,
file = paste_out("otra3.xlsx"))
unique(crudo_otra1$otra1)
#------------------------------------------------------------------------------#
# Proyecto:                   Monitor PPD 2023
# Objetivo:                   Reporte de desempeño: captura de notas
#
# Encargado:                  Alejandro Pocoroba
# Correo:                     alejandro.pocoroba@cide.edu
# Fecha de creación:          01 de agosto de 2023
# Última actualización:       01 de agosto de 2023
#------------------------------------------------------------------------------#
# Fuente: Monitor PPD versión abril - junio 2023
# 0. Configuración inicial -----------------------------------------------------
# Silenciar mensajes de .group en dplyr
options(dplyr.summarise.inform = FALSE)
# Librerías
require(pacman)
p_load(
readxl, tidyverse, dplyr, srvyr, zoo, ggtext, beepr, lubridate, stringr, janitor, stringi)
# Limpiar espacio de trabajo
rm(list=ls())
# Funciones con direcciones de las carpetas
paste_inp <- function(x){paste0("02_datos_crudos/" , x)}
paste_out <- function(x){paste0("03_datos_limpios/", x)}
paste_fig <- function(x){paste0("04_figuras/"      , x)}
# 1. Cargar datos --------------------------------------------------------------
c <- read_xlsx(paste_inp("monitor_abril_2023.xlsx"))
b <- read_xlsx(paste_inp("monitor_junio_2023.xlsx"))
d <- read_xlsx(paste_inp("monitor_marzo_2023.xlsx"))
# Se unen bases
a <- c %>%
bind_rows(b) %>%
bind_rows(d)
# 2. Procesamiento -------------------------------------------------------------
# Limpieza de nombres y variables de interés
crudo <- a %>%
janitor::clean_names() %>%
select(estado:observaciones)
# Tratamiento de fechas #
crudo$"fecha" <- as.Date(crudo$"fecha")
crudo$dia     <- format(crudo$"fecha", "%d")
crudo$mes     <- format(crudo$"fecha", "%m")
crudo$anio    <- format(crudo$"fecha", "%Y")
# Estado según su clave de Inegi
crudo <- crudo %>%
mutate(
claveEdo = str_sub(estado, -2, -1))
# Limpiar T/F por 1/0
crudo$violencia_armade_fuego <- as.character(crudo$violencia_armade_fuego)
crudo$homicidios <- as.character(crudo$homicidios)
crudo$heridxs <- as.character(crudo$heridxs)
crudo$genero <- as.character(crudo$genero)
crudo$presencia_criminal <- as.character(crudo$presencia_criminal)
crudo$actividades_delictivas <- as.character(crudo$actividades_delictivas)
crudo$detenciones <- as.character(crudo$detenciones)
crudo$acciones_gubernamentales <- as.character(crudo$acciones_gubernamentales)
crudo$politica_seguridad <- as.character(crudo$politica_seguridad)
limpiar_tf <- function(x){
case_when(
x == "FALSE" ~ "0",
x == "TRUE"  ~ "1",
x == x ~ x
)
}
crudo <- crudo %>%
mutate_at(.vars = c("violencia_armade_fuego", "homicidios", "heridxs",
"genero", "presencia_criminal", "actividades_delictivas",
"detenciones", "acciones_gubernamentales", "politica_seguridad"),
.funs = ~limpiar_tf(.))
# Limpieza de texto
# minúsculas
crudo <- crudo %>%
mutate_at(.vars = c("otra", "observaciones"),
.funs = ~str_to_lower(.))
# acentos
crudo$otra          <- stri_trans_general(crudo$otra, "Latin-ASCII")
crudo$observaciones <- stri_trans_general(crudo$observaciones, "Latin-ASCII")
# Limpieza variable otra
# separar valores
crudo_otra1 <- crudo %>%
mutate(otra = str_replace_all(otra, "/", ";"),
otra = str_replace_all(otra, ":", ";")) %>%
separate(otra, sep = ";", c("otra1", "otra2","otra3"))
